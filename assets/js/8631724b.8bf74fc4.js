"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9505],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return h}});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(t),h=r,g=d["".concat(l,".").concat(h)]||d[h]||u[h]||o;return t?a.createElement(g,i(i({ref:n},c),{},{components:t})):a.createElement(g,i({ref:n},c))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},19340:function(e,n,t){var a=t(84035),r=t(21720),o=t.n(r),i=t(67294);n.Z=function(e){var n=e.prerelease,t=(0,i.useState)({latest:"v2.3.0",prerelease:"v2.4.0-beta.1"}),r=t[0],s=t[1];return(0,i.useEffect)((function(){(0,a.Z)(o().mark((function e(){var n,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://releases.hasura.io/graphql-engine?agent=docs.hasura.io");case 2:return n=e.sent,e.next=5,n.json();case 5:t=e.sent,s(t);case 7:case"end":return e.stop()}}),e)})))()}),[]),i.createElement("span",null,n?r.prerelease:r.latest)}},66437:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return p},default:function(){return g},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var a=t(83117),r=t(80102),o=(t(67294),t(3905)),i=t(19340),s=["components"],l={description:"Deploy Hasura GraphQL engine with Docker",keywords:["hasura","docs","deployment","docker"],sidebar_position:3,sidebar_label:"Using Docker"},p="Run Hasura GraphQL engine using Docker",c={unversionedId:"graphql/core/deployment/deployment-guides/docker",id:"graphql/core/deployment/deployment-guides/docker",title:"Run Hasura GraphQL engine using Docker",description:"Deploy Hasura GraphQL engine with Docker",source:"@site/docs/graphql/core/deployment/deployment-guides/docker.mdx",sourceDirName:"graphql/core/deployment/deployment-guides",slug:"/graphql/core/deployment/deployment-guides/docker",permalink:"/docs/latest/graphql/core/deployment/deployment-guides/docker",editUrl:"https://github.com/hasura/graphql-engine/edit/master/docs/docs/graphql/core/deployment/deployment-guides/docker.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{description:"Deploy Hasura GraphQL engine with Docker",keywords:["hasura","docs","deployment","docker"],sidebar_position:3,sidebar_label:"Using Docker"},sidebar:"docsSidebar",previous:{title:"Deployment guides",permalink:"/docs/latest/graphql/core/deployment/deployment-guides/index"},next:{title:"Using Kubernetes",permalink:"/docs/latest/graphql/core/deployment/deployment-guides/kubernetes"}},u={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Deploying Hasura using Docker",id:"deploying-hasura-using-docker",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Step 1: Get the docker-compose file",id:"step-1-get-the-docker-compose-file",level:2},{value:"Step 2: Run Hasura GraphQL engine",id:"step-2-run-hasura-graphql-engine",level:2},{value:"Securing the GraphQL endpoint",id:"docker-secure",level:2},{value:"Run the Docker container with an admin-secret env var",id:"run-the-docker-container-with-an-admin-secret-env-var",level:3},{value:"Hasura GraphQL engine server logs",id:"docker-logs",level:2},{value:"Updating Hasura GraphQL engine",id:"docker-update",level:2},{value:"Step 1: Check the latest release version",id:"step-1-check-the-latest-release-version",level:3},{value:"Step 2: Update the Docker image",id:"step-2-update-the-docker-image",level:3},{value:"Advanced",id:"advanced",level:2}],h={toc:d};function g(e){var n=e.components,t=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},h,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"run-hasura-graphql-engine-using-docker"},"Run Hasura GraphQL engine using Docker"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"This guide will help you deploy the Hasura GraphQL engine and a Postgres\ndatabase to store its metadata using Docker Compose."),(0,o.kt)("h2",{id:"deploying-hasura-using-docker"},"Deploying Hasura using Docker"),(0,o.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/install/"},"Docker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/install/"},"Docker Compose"))),(0,o.kt)("h2",{id:"step-1-get-the-docker-compose-file"},"Step 1: Get the docker-compose file"),(0,o.kt)("p",null,"The\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hasura/graphql-engine/tree/stable/install-manifests"},"hasura/graphql-engine/install-manifests"),"\nrepo contains all installation manifests required to deploy Hasura\nanywhere. Get the docker compose file from there:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# in a new directory run\nwget https://raw.githubusercontent.com/hasura/graphql-engine/stable/install-manifests/docker-compose/docker-compose.yaml\n# or run\ncurl https://raw.githubusercontent.com/hasura/graphql-engine/stable/install-manifests/docker-compose/docker-compose.yaml -o docker-compose.yml\n")),(0,o.kt)("h2",{id:"step-2-run-hasura-graphql-engine"},"Step 2: Run Hasura GraphQL engine"),(0,o.kt)("p",null,"The following command will run Hasura GraphQL engine along with a\nPostgres database to store its metadata."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker-compose up -d\n")),(0,o.kt)("p",null,"Check if the containers are running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker ps\n\nCONTAINER ID IMAGE                 ... CREATED STATUS PORTS          ...\n097f58433a2b hasura/graphql-engine ... 1m ago  Up 1m  8080->8080/tcp ...\nb0b1aac0508d postgres              ... 1m ago  Up 1m  5432/tcp       ...\n")),(0,o.kt)("h2",{id:"docker-secure"},"Securing the GraphQL endpoint"),(0,o.kt)("p",null,"To make sure that your GraphQL endpoint and the Hasura console are not\npublicly accessible, you need to configure an admin secret key."),(0,o.kt)("h3",{id:"run-the-docker-container-with-an-admin-secret-env-var"},"Run the Docker container with an admin-secret env var"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{5}","{5}":!0},"graphql-engine:\n  image: hasura/graphql-engine:v2.0.0\n  environment:\n    HASURA_GRAPHQL_METADATA_DATABASE_URL: postgres://postgres:postgrespassword@postgres:5432/postgres\n    HASURA_GRAPHQL_ADMIN_SECRET: myadminsecretkey\n  ...\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"HASURA_GRAPHQL_ADMIN_SECRET")," should never be passed from the client\nto the Hasura GraphQL engine as it would give the client full admin\nrights to your Hasura instance. See ",(0,o.kt)("a",{parentName:"p",href:"/docs/latest/graphql/core/auth/index"},"Authentication & Authorization")," for information on setting up\nauthentication."))),(0,o.kt)("h2",{id:"docker-logs"},"Hasura GraphQL engine server logs"),(0,o.kt)("p",null,"You can check the logs of the Hasura GraphQL engine deployed using\nDocker by checking the logs of the GraphQL engine container:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'$ docker ps\n\nCONTAINER ID IMAGE                 ... CREATED STATUS PORTS          ...\n097f58433a2b hasura/graphql-engine ... 1m ago  Up 1m  8080->8080/tcp ...\nb0b1aac0508d postgres              ... 1m ago  Up 1m  5432/tcp       ...\n\n\n$ docker logs 097f58433a2b\n\n{"timestamp":"2018-10-09T11:20:32.054+0000", "level":"info", "type":"http-log", "detail":{"status":200, "query_hash":"01640c6dd131826cff44308111ed40d7fbd1cbed", "http_version":"HTTP/1.1", "query_execution_time":3.0177627e-2, "request_id":null, "url":"/v1/graphql", "user":{"x-hasura-role":"admin"}, "ip":"127.0.0.1", "response_size":209329, "method":"POST", "detail":null}}\n...\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"See:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/config/containers/logging"},"https://docs.docker.com/config/containers/logging")," for more details\non logging in Docker."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/latest/graphql/core/deployment/logging"},"Hasura GraphQL engine logs")," for more details on Hasura logs.")),(0,o.kt)("h2",{id:"docker-update"},"Updating Hasura GraphQL engine"),(0,o.kt)("p",null,"This guide will help you update the Hasura GraphQL engine running with\nDocker. This guide assumes that you already have Hasura GraphQL engine\nrunning with Docker."),(0,o.kt)("h3",{id:"step-1-check-the-latest-release-version"},"Step 1: Check the latest release version"),(0,o.kt)("p",null,"The current latest version is:"),(0,o.kt)("code",null,"hasura/graphql-engine:",(0,o.kt)(i.Z,{mdxType:"LatestRelease"})),(0,o.kt)("p",null,"All the versions can be found at:\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hasura/graphql-engine/releases"},"https://github.com/hasura/graphql-engine/releases")),(0,o.kt)("h3",{id:"step-2-update-the-docker-image"},"Step 2: Update the Docker image"),(0,o.kt)("p",null,"In the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," command that you're running, update the image\ntag to this latest version."),(0,o.kt)("p",null,"For example, if you had:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"graphql-engine:\n  image: hasura/graphql-engine:v1.2.0\n")),(0,o.kt)("p",null,"you should change it to:"),(0,o.kt)("pre",null,(0,o.kt)("code",null,"graphql-engine:",(0,o.kt)("br",null),"  ","image: hasura/graphql-engine:",(0,o.kt)(i.Z,{mdxType:"LatestRelease"}))),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If you are downgrading to an older version of the GraphQL engine you\nmight need to downgrade your metadata catalogue version as described in\n",(0,o.kt)("a",{parentName:"p",href:"/docs/latest/graphql/core/deployment/downgrading"},"Downgrading Hasura GraphQL engine")))),(0,o.kt)("h2",{id:"advanced"},"Advanced"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/latest/graphql/core/migrations/index"},"Setting up migrations"))))}g.isMDXComponent=!0}}]);