"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4070],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return g}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),g=r,v=u["".concat(s,".").concat(g)]||u[g]||d[g]||o;return n?a.createElement(v,l(l({ref:t},p),{},{components:n})):a.createElement(v,l({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},92666:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return d}});var a=n(83117),r=n(80102),o=(n(67294),n(3905)),l=["components"],i={sidebar_label:"Cleaning up event data",sidebar_position:7,description:"Clean up event data of event triggers in Hasura",keywords:["hasura","docs","event trigger","event data","clean up"]},s="Cleaning up event data",c={unversionedId:"graphql/core/event-triggers/clean-up",id:"graphql/core/event-triggers/clean-up",title:"Cleaning up event data",description:"Clean up event data of event triggers in Hasura",source:"@site/docs/graphql/core/event-triggers/clean-up.mdx",sourceDirName:"graphql/core/event-triggers",slug:"/graphql/core/event-triggers/clean-up",permalink:"/graphql-engine/latest/graphql/core/event-triggers/clean-up",editUrl:"https://github.com/hasura/graphql-engine/edit/master/docs/docs/graphql/core/event-triggers/clean-up.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_label:"Cleaning up event data",sidebar_position:7,description:"Clean up event data of event triggers in Hasura",keywords:["hasura","docs","event trigger","event data","clean up"]},sidebar:"docsSidebar",previous:{title:"Event trigger samples",permalink:"/graphql-engine/latest/graphql/core/event-triggers/samples"},next:{title:"Scheduled Triggers",permalink:"/graphql-engine/latest/graphql/core/scheduled-triggers/index"}},p={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Tables involved",id:"tables-involved",level:2},{value:"Option 1: Clear only HTTP logs",id:"option-1-clear-only-http-logs",level:2},{value:"Option 2: Clear only processed events",id:"option-2-clear-only-processed-events",level:2},{value:"Option 3: Clear all processed events and HTTP logs",id:"option-3-clear-all-processed-events-and-http-logs",level:2},{value:"Option 4: Clear all event data for a particular event trigger only",id:"option-4-clear-all-event-data-for-a-particular-event-trigger-only",level:2},{value:"Option 5: Clear everything",id:"option-5-clear-everything",level:2},{value:"Clearing data before a particular time period",id:"clearing-data-before-a-particular-time-period",level:2}],u={toc:d};function g(e){var t=e.components,n=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"cleaning-up-event-data"},"Cleaning up event data"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Hasura stores event data associated with Event Triggers in ",(0,o.kt)("strong",{parentName:"p"},'the "hdb_catalog" schema of the database containing the source table'),"."),(0,o.kt)("p",null,"If there are lots of events, the metadata tables can get huge and you may want to prune them.\nYou can use any of the following options to prune your event data depending on your need."),(0,o.kt)("h2",{id:"tables-involved"},"Tables involved"),(0,o.kt)("p",null,"Event Triggers have 2 tables managed by Hasura:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"hdb_catalog.event_log"),": This is the table that stores all captured\nevents."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"hdb_catalog.event_invocation_logs"),": This is that table that stores\nall HTTP requests and responses.")),(0,o.kt)("h2",{id:"option-1-clear-only-http-logs"},"Option 1: Clear only HTTP logs"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.event_invocation_logs;\n")),(0,o.kt)("h2",{id:"option-2-clear-only-processed-events"},"Option 2: Clear only processed events"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.event_log\nWHERE delivered = true OR error = true;\n")),(0,o.kt)("h2",{id:"option-3-clear-all-processed-events-and-http-logs"},"Option 3: Clear all processed events and HTTP logs"),(0,o.kt)("p",null,"This is the combination of Option 1 and Option 2."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.event_invocation_logs;\n\nDELETE FROM hdb_catalog.event_log\nWHERE delivered = true OR error = true;\n")),(0,o.kt)("h2",{id:"option-4-clear-all-event-data-for-a-particular-event-trigger-only"},"Option 4: Clear all event data for a particular event trigger only"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM\nhdb_catalog.event_invocation_logs\nWHERE event_id IN (\n    SELECT id FROM hdb_catalog.event_log\n    WHERE trigger_name = '<event_trigger_name>' );\n\nDELETE FROM\nhdb_catalog.event_log\nWHERE trigger_name = '<event_trigger_name>'\nAND (delivered = true OR error = true);\n")),(0,o.kt)("h2",{id:"option-5-clear-everything"},"Option 5: Clear everything"),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Warning")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This will clear all events including yet to be delivered events."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.event_invocation_logs;\n\nDELETE FROM hdb_catalog.event_log;\n")),(0,o.kt)("h2",{id:"clearing-data-before-a-particular-time-period"},"Clearing data before a particular time period"),(0,o.kt)("p",null,"If you wish to keep recent data and only clear data before a particular\ntime period you can add the following time clause to your query's where\nclause:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"-- units can be 'minutes', 'hours', 'days', 'months', 'years'\ncreated_at < now() - interval '<x> <units>'\n")),(0,o.kt)("p",null,"For example: to delete all processed events and HTTP logs older than 3\nmonths:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.event_invocation_logs\nWHERE created_at < now() - interval '3 months';\n\nDELETE FROM hdb_catalog.event_log\nWHERE (delivered = true OR error = true)\n AND created_at < now() - interval '3 months';\n")),(0,o.kt)("p",null,"See the ",(0,o.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/functions-datetime.html"},"Postgres date/time functions"),"\nfor more details."))}g.isMDXComponent=!0}}]);