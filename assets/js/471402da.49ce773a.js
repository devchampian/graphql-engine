"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4469],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return g}});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var c=n.createContext({}),s=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(a),g=o,m=d["".concat(c,".").concat(g)]||d[g]||u[g]||r;return a?n.createElement(m,i(i({ref:t},p),{},{components:a})):n.createElement(m,i({ref:t},p))}));function g(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9686:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return g},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return u}});var n=a(83117),o=a(80102),r=(a(67294),a(3905)),i=["components"],l={sidebar_label:"Cleaning up async action logs",sidebar_position:11,description:"Clean up async action logs",keywords:["hasura","docs","actions","clean up","async actions"]},c="Cleaning up async action logs",s={unversionedId:"graphql/core/actions/logs-clean-up",id:"graphql/core/actions/logs-clean-up",title:"Cleaning up async action logs",description:"Clean up async action logs",source:"@site/docs/graphql/core/actions/logs-clean-up.mdx",sourceDirName:"graphql/core/actions",slug:"/graphql/core/actions/logs-clean-up",permalink:"/graphql-engine/latest/graphql/core/actions/logs-clean-up",editUrl:"https://github.com/hasura/graphql-engine/edit/master/docs/docs/graphql/core/actions/logs-clean-up.mdx",tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_label:"Cleaning up async action logs",sidebar_position:11,description:"Clean up async action logs",keywords:["hasura","docs","actions","clean up","async actions"]},sidebar:"docsSidebar",previous:{title:"Debugging actions",permalink:"/graphql-engine/latest/graphql/core/actions/debugging"},next:{title:"Remote Schemas",permalink:"/graphql-engine/latest/graphql/core/remote-schemas/index"}},p={},u=[{value:"Introduction",id:"introduction",level:2},{value:"The table involved",id:"the-table-involved",level:2},{value:"Option 1: Delete log of a particular action invocation",id:"option-1-delete-log-of-a-particular-action-invocation",level:2},{value:"Option 2: Delete all logs of a specific action",id:"option-2-delete-all-logs-of-a-specific-action",level:2},{value:"Option 3: Delete all logs",id:"option-3-delete-all-logs",level:2},{value:"Clearing data before a particular time period",id:"clearing-data-before-a-particular-time-period",level:2}],d={toc:u};function g(e){var t=e.components,a=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"cleaning-up-async-action-logs"},"Cleaning up async action logs"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Hasura stores action logs of ",(0,r.kt)("a",{parentName:"p",href:"/graphql-engine/latest/graphql/core/actions/async-actions"},"async actions")," in a table\nin ",(0,r.kt)("strong",{parentName:"p"},'the "hdb_catalog" schema of the Hasura metadata database'),"."),(0,r.kt)("p",null,"As the table gets larger, you may want to prune it. You can use any of the following options to prune your logs depending on\nyour need."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Deleting logs is irreversible, so be careful with these actions."),(0,r.kt)("li",{parentName:"ul"},"Deleting logs while subscriptions for the response might still be\nopen may result into the loss of data and ",(0,r.kt)("inlineCode",{parentName:"li"},"null")," values been\nreturned.")))),(0,r.kt)("h2",{id:"the-table-involved"},"The table involved"),(0,r.kt)("p",null,"There is a specific table for action logs that is managed by Hasura:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hdb_catalog.hdb_action_log"),": This table stores all captured action logs.")),(0,r.kt)("h2",{id:"option-1-delete-log-of-a-particular-action-invocation"},"Option 1: Delete log of a particular action invocation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_action_log WHERE id = '<async-action-id>';\n")),(0,r.kt)("h2",{id:"option-2-delete-all-logs-of-a-specific-action"},"Option 2: Delete all logs of a specific action"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_action_log WHERE action_name = '<action-name>';\n")),(0,r.kt)("h2",{id:"option-3-delete-all-logs"},"Option 3: Delete all logs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_action_log;\n")),(0,r.kt)("h2",{id:"clearing-data-before-a-particular-time-period"},"Clearing data before a particular time period"),(0,r.kt)("p",null,"If you wish to keep recent data and only clear data before a particular time period\nyou can add the following time clause to your query's where clause:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- units can be 'minutes', 'hours', 'days', 'months', 'years'\ncreated_at < now() - interval '<x> <units>'\n")),(0,r.kt)("p",null,"For example: to delete all logs older than 3 months:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_action_log WHERE created_at < NOW() - INTERVAL '3 months';\n")),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/functions-datetime.html"},"Postgres date/time functions")," for more details."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Additional Resources")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Introduction to Hasura Actions - ",(0,r.kt)("a",{parentName:"p",href:"https://hasura.io/events/webinar/hasura-actions/?pg=docs&plcmt=body&cta=view-recording&tech="},"View Recording"),"."))))}g.isMDXComponent=!0}}]);