"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5156],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return c}});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=p(t),c=i,m=h["".concat(s,".").concat(c)]||h[c]||u[c]||r;return t?a.createElement(m,o(o({ref:n},d),{},{components:t})):a.createElement(m,o({ref:n},d))}));function c(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=h;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},22138:function(e,n,t){var a=t(67294),i=t(57932),r=t(72389),o=t(86010),l=t(71077);n.Z=function(e){var n=e.query,t=e.variables,s=e.response,p=e.viewOnly,d=void 0===p||p,u=(0,r.Z)();return a.createElement("div",{className:"graphiql "+(0,o.Z)({"with-vars":!!t,"view-only":d})},a.createElement(i.ZP,{readOnly:d,editorTheme:"dracula",schema:null,fetcher:u?(0,l.n)({url:"https://hasura.io/graphql"}):function(){return null},query:n,variables:t,response:s}))}},60907:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return h}});var a=t(83117),i=t(80102),r=(t(67294),t(3905)),o=t(22138),l=["components"],s={description:"Model one-to-one relationships in Hasura",keywords:["hasura","docs","schema","relationship","one-to-one","1-1"],sidebar_position:2,sidebar_label:"One-to-one relationship"},p="Modelling one-to-one table relationships",d={unversionedId:"graphql/core/guides/data-modelling/one-to-one",id:"graphql/core/guides/data-modelling/one-to-one",title:"Modelling one-to-one table relationships",description:"Model one-to-one relationships in Hasura",source:"@site/docs/graphql/core/guides/data-modelling/one-to-one.mdx",sourceDirName:"graphql/core/guides/data-modelling",slug:"/graphql/core/guides/data-modelling/one-to-one",permalink:"/graphql-engine/latest/graphql/core/guides/data-modelling/one-to-one",editUrl:"https://github.com/hasura/graphql-engine/edit/master/docs/docs/graphql/core/guides/data-modelling/one-to-one.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{description:"Model one-to-one relationships in Hasura",keywords:["hasura","docs","schema","relationship","one-to-one","1-1"],sidebar_position:2,sidebar_label:"One-to-one relationship"},sidebar:"docsSidebar",previous:{title:"Guides: Data modelling",permalink:"/graphql-engine/latest/graphql/core/guides/data-modelling/index"},next:{title:"One-to-many relationship",permalink:"/graphql-engine/latest/graphql/core/guides/data-modelling/one-to-many"}},u={},h=[{value:"Introduction",id:"introduction",level:2},{value:"Step 1: Set up a table relationship in the database",id:"step-1-set-up-a-table-relationship-in-the-database",level:2},{value:"Step 2: Set up GraphQL relationships",id:"step-2-set-up-graphql-relationships",level:2},{value:"Query using one-to-one relationships",id:"query-using-one-to-one-relationships",level:2},{value:"Insert using one-to-one relationships",id:"one-to-one-insert",level:2},{value:"Caveat for nested inserts",id:"caveat-for-nested-inserts",level:3}],c={toc:h};function m(e){var n=e.components,t=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"modelling-one-to-one-table-relationships"},"Modelling one-to-one table relationships"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"one-to-one")," relationship between two tables can be established via a\n",(0,r.kt)("strong",{parentName:"p"},"unique foreign key constraint"),"."),(0,r.kt)("p",null,"Say we have the following two tables in our database schema:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"authors (\n  id SERIAL PRIMARY KEY,\n  name TEXT\n)\n\npassport_info (\n  id SERIAL PRIMARY KEY,\n  owner_id INT NOT NULL\n  passport_number TEXT\n  ...\n)\n")),(0,r.kt)("p",null,"These two tables are related via a ",(0,r.kt)("inlineCode",{parentName:"p"},"one-to-one")," relationship. i.e.:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"an ",(0,r.kt)("inlineCode",{parentName:"li"},"author")," can have one ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info")),(0,r.kt)("li",{parentName:"ul"},"a ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info")," has one ",(0,r.kt)("inlineCode",{parentName:"li"},"owner"))),(0,r.kt)("h2",{id:"step-1-set-up-a-table-relationship-in-the-database"},"Step 1: Set up a table relationship in the database"),(0,r.kt)("p",null,"This ",(0,r.kt)("inlineCode",{parentName:"p"},"one-to-one")," relationship can be established in the database by:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Adding a ",(0,r.kt)("strong",{parentName:"li"},"foreign key constraint")," from the ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info")," table\nto the ",(0,r.kt)("inlineCode",{parentName:"li"},"authors")," table using the ",(0,r.kt)("inlineCode",{parentName:"li"},"owner_id")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," columns of the\ntables respectively"),(0,r.kt)("li",{parentName:"ol"},"Adding a ",(0,r.kt)("strong",{parentName:"li"},"unique constraint")," to the ",(0,r.kt)("inlineCode",{parentName:"li"},"owner_id")," column for the\n",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info")," table")),(0,r.kt)("p",null,"This will ensure that the value of the ",(0,r.kt)("inlineCode",{parentName:"p"},"owner_id")," column in\n",(0,r.kt)("inlineCode",{parentName:"p"},"passport_info")," table is present in the ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," column of the ",(0,r.kt)("inlineCode",{parentName:"p"},"authors"),"\ntable and there will be only one row with a particular ",(0,r.kt)("inlineCode",{parentName:"p"},"owner_id"),"."),(0,r.kt)("h2",{id:"step-2-set-up-graphql-relationships"},"Step 2: Set up GraphQL relationships"),(0,r.kt)("p",null,"To access the nested objects via the GraphQL API,\n",(0,r.kt)("a",{parentName:"p",href:"/graphql-engine/latest/graphql/core/databases/postgres/schema/table-relationships/create"},"create the following relationships"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Object relationship, ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info")," from the ",(0,r.kt)("inlineCode",{parentName:"li"},"authors")," table using\n",(0,r.kt)("inlineCode",{parentName:"li"},"id -> passport_info :: owner_id")),(0,r.kt)("li",{parentName:"ul"},"Object relationship, ",(0,r.kt)("inlineCode",{parentName:"li"},"owner")," from the ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info")," table using\n",(0,r.kt)("inlineCode",{parentName:"li"},"owner_id -> authors :: id"))),(0,r.kt)("h2",{id:"query-using-one-to-one-relationships"},"Query using one-to-one relationships"),(0,r.kt)("p",null,"We can now:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"fetch a list of ",(0,r.kt)("inlineCode",{parentName:"li"},"authors")," with their ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info"),":")),(0,r.kt)(o.Z,{query:"query {\n  authors {\n    id\n    name\n    passport_info {\n      id\n      passport_number\n    }\n  }\n }",response:'{\n  "data": {\n    "authors": [\n      {\n        "id": 1,\n        "name": "Justin",\n        "passport_info": {\n          "id": 1,\n          "passport_number": "987456234"\n        }\n      },\n      {\n        "id": 2,\n        "name": "Beltran",\n        "passport_info": {\n          "id": 2,\n          "passport_number": "F0004586"\n        }\n      }\n    ]\n  }\n }',mdxType:"GraphiQLIDE"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"fetch a list of ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_infos")," with their ",(0,r.kt)("inlineCode",{parentName:"li"},"owner"),":")),(0,r.kt)(o.Z,{query:"query {\n  passport_info {\n    id\n    passport_number\n    owner {\n      id\n      name\n    }\n  }\n }",response:'{\n  "data": {\n    "passport_info": [\n      {\n        "id": 1,\n        "passport_number": "987456234",\n        "owner": {\n          "id": 1,\n          "name": "Justin"\n        }\n      },\n      {\n        "id": 2,\n        "passport_number": "F0004586",\n        "owner": {\n          "id": 2,\n          "name": "Beltran"\n        }\n      }\n    ]\n  }\n }',mdxType:"GraphiQLIDE"}),(0,r.kt)("h2",{id:"one-to-one-insert"},"Insert using one-to-one relationships"),(0,r.kt)("p",null,"We can now:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"insert ",(0,r.kt)("inlineCode",{parentName:"li"},"passport_info")," with their ",(0,r.kt)("inlineCode",{parentName:"li"},"owner")," where the ",(0,r.kt)("inlineCode",{parentName:"li"},"owner")," might\nalready exist (assume unique ",(0,r.kt)("inlineCode",{parentName:"li"},"name")," for ",(0,r.kt)("inlineCode",{parentName:"li"},"owner"),"):")),(0,r.kt)(o.Z,{query:'mutation upsertPassportInfoWithOwner {\n  insert_passport_info(objects: [\n    {\n      passport_number: "X98973765",\n      owner: {\n        data: {\n          name: "Kelly"\n        },\n        on_conflict: {\n          constraint: owner_name_key,\n          update_columns: [name]\n        }\n      },\n    }\n  ]) {\n    returning {\n      passport_number\n      owner {\n        name\n      }\n    }\n  }\n }',response:'{\n  "data": {\n    "insert_passport_info": {\n      "returning": [\n        {\n          "passport_number": "X98973765",\n          "owner": {\n            "name": "Kelly"\n          }\n        }\n      ]\n    }\n  }\n }',mdxType:"GraphiQLIDE"}),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can avoid the ",(0,r.kt)("inlineCode",{parentName:"p"},"on_conflict")," clause if you will never have conflicts."))),(0,r.kt)("h3",{id:"caveat-for-nested-inserts"},"Caveat for nested inserts"),(0,r.kt)("p",null,"Due to the way nested inserts are typically handled (described ",(0,r.kt)("a",{parentName:"p",href:"/graphql-engine/latest/graphql/core/databases/postgres/mutations/insert#pg-nested-inserts"},"here"),"), the order of object insertion needs to be\nspecified using the ",(0,r.kt)("a",{parentName:"p",href:"/graphql-engine/latest/graphql/core/api-reference/syntax-defs#objrelusingmanualmapping"},"insertion_order")," option\nwhile creating one-to-one relationships via the API. This is necessary\nto ensure nested inserts are possible using either side as the parent\nwhich would otherwise error out with a ",(0,r.kt)("inlineCode",{parentName:"p"},"Not-NULL violation")," error in one\nof the cases."),(0,r.kt)("p",null,"In our example, inserting a ",(0,r.kt)("inlineCode",{parentName:"p"},"passport_info")," with their nested ",(0,r.kt)("inlineCode",{parentName:"p"},"owner"),"\nwill work seamlessly but trying to insert an ",(0,r.kt)("inlineCode",{parentName:"p"},"author")," with their nested\n",(0,r.kt)("inlineCode",{parentName:"p"},"passport_info")," will throw a constraint violation error in case the\ninsertion order is not specified for the ",(0,r.kt)("inlineCode",{parentName:"p"},"owner")," object relationship."))}m.isMDXComponent=!0}}]);