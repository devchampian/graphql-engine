"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8827],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return g}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=d(a),g=r,h=p["".concat(s,".").concat(g)]||p[g]||u[g]||l;return a?n.createElement(h,o(o({ref:t},c),{},{components:a})):n.createElement(h,o({ref:t},c))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,o=new Array(l);o[0]=p;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var d=2;d<l;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},57025:function(e,t,a){a.r(t),a.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return u}});var n=a(83117),r=a(80102),l=(a(67294),a(3905)),o=["components"],i={description:"Clean up event data of scheduled triggers in Hasura",keywords:["hasura","docs","scheduled triggers","cron trigger","scheduled events","clean up","purge logs"],sidebar_position:3},s="Cleaning up scheduled triggers data",d={unversionedId:"graphql/core/scheduled-triggers/clean-up",id:"graphql/core/scheduled-triggers/clean-up",title:"Cleaning up scheduled triggers data",description:"Clean up event data of scheduled triggers in Hasura",source:"@site/docs/graphql/core/scheduled-triggers/clean-up.mdx",sourceDirName:"graphql/core/scheduled-triggers",slug:"/graphql/core/scheduled-triggers/clean-up",permalink:"/docs/latest/graphql/core/scheduled-triggers/clean-up",editUrl:"https://github.com/hasura/graphql-engine/edit/master/docs/docs/graphql/core/scheduled-triggers/clean-up.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{description:"Clean up event data of scheduled triggers in Hasura",keywords:["hasura","docs","scheduled triggers","cron trigger","scheduled events","clean up","purge logs"],sidebar_position:3},sidebar:"docsSidebar",previous:{title:"Creating a one-off scheduled event",permalink:"/docs/latest/graphql/core/scheduled-triggers/create-one-off-scheduled-event"},next:{title:"Authentication & Authorization",permalink:"/docs/latest/graphql/core/auth/index"}},c={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Tables involved",id:"tables-involved",level:2},{value:"Option 1: Clear only HTTP logs",id:"option-1-clear-only-http-logs",level:2},{value:"Option 2: Clear processed events",id:"option-2-clear-processed-events",level:2},{value:"Option 3: Clear all data for a particular cron trigger only",id:"option-3-clear-all-data-for-a-particular-cron-trigger-only",level:2},{value:"Option 4: Clear everything",id:"option-4-clear-everything",level:2},{value:"Clearing data before a particular time period",id:"clearing-data-before-a-particular-time-period",level:2}],p={toc:u};function g(e){var t=e.components,a=(0,r.Z)(e,o);return(0,l.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"cleaning-up-scheduled-triggers-data"},"Cleaning up scheduled triggers data"),(0,l.kt)("h2",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"Hasura stores event data associated with scheduled triggers in ",(0,l.kt)("strong",{parentName:"p"},'the "hdb_catalog" schema of the Hasura metadata database'),"."),(0,l.kt)("p",null,"If there are lots of events, the events tables can get huge and you may want to prune them. You can use any of the following options to prune your event data depending on your need."),(0,l.kt)("h2",{id:"tables-involved"},"Tables involved"),(0,l.kt)("p",null,"Cron triggers have two tables managed by Hasura:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"hdb_catalog.hdb_cron_events"),": Table that stores all the cron events."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"hdb_catalog.hdb_cron_event_invocation_logs"),": Table that stores all the HTTP requests and their responses of the cron events invocations.")),(0,l.kt)("p",null,"Similarly, scheduled events also have two tables managed by Hasura:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"hdb_catalog.hdb_scheduled_events"),": Table that stores all the scheduled events."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"hdb_catalog.hdb_scheduled_event_invocation_logs"),": Table that stores all the HTTP requests and their responses of the scheduled events invocations.")),(0,l.kt)("h2",{id:"option-1-clear-only-http-logs"},"Option 1: Clear only HTTP logs"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Cron event invocation logs")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_cron_event_invocation_logs;\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Scheduled event invocation logs")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_scheduled_event_invocation_logs;\n")),(0,l.kt)("h2",{id:"option-2-clear-processed-events"},"Option 2: Clear processed events"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Cron events")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_cron_events\nWHERE status IN ('delivered', 'error', 'dead');\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Scheduled events")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_scheduled_events\nWHERE status IN ('delivered', 'error', 'dead');\n")),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Deleting a cron/scheduled event will also delete the invocations related\nto that event."))),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Warning")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The below options will clear all events including yet to be delivered\nevents. If the cron trigger exists in the metadata, then new events will\nbe generated automatically by the graphql-engine, but this step can take\nupto a minute."))),(0,l.kt)("h2",{id:"option-3-clear-all-data-for-a-particular-cron-trigger-only"},"Option 3: Clear all data for a particular cron trigger only"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_cron_events\nWHERE trigger_name = '<trigger_name>';\n")),(0,l.kt)("h2",{id:"option-4-clear-everything"},"Option 4: Clear everything"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Cron triggers")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_cron_events;\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Scheduled events")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_scheduled_events;\n")),(0,l.kt)("h2",{id:"clearing-data-before-a-particular-time-period"},"Clearing data before a particular time period"),(0,l.kt)("p",null,"If you wish to keep recent data and only clear data before a particular time period you can add the following time clause to your query's where clause:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- units can be 'minutes', 'hours', 'days', 'months', 'years'\ncreated_at < now() - interval '<x> <units>'\n")),(0,l.kt)("p",null,"For example: to delete all processed events and HTTP logs older than 3 months:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Cron triggers")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_cron_events\nWHERE status IN ('delivered', 'error', 'dead')\n  AND created_at < now() - interval '3 months';\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Scheduled events")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM hdb_catalog.hdb_scheduled_events\nWHERE status IN ('delivered', 'error', 'dead')\n AND created_at < now() - interval '3 months';\n")),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/functions-datetime.html"},"Postgres date/time functions")," for more details."))}g.isMDXComponent=!0}}]);