"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8267],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return d}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),m=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=m(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=m(a),d=r,g=p["".concat(l,".").concat(d)]||p[d]||u[d]||i;return a?n.createElement(g,o(o({ref:t},c),{},{components:a})):n.createElement(g,o({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var m=2;m<i;m++)o[m]=a[m];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},73780:function(e,t,a){a.r(t),a.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return s},metadata:function(){return m},toc:function(){return u}});var n=a(83117),r=a(80102),i=(a(67294),a(3905)),o=["components"],s={sidebar_label:"Resetting Hasura migrations",sidebar_position:5,description:"Resetting Hasura migrations",keywords:["hasura","docs","migration","reset migrations","clear migrations"]},l="Resetting Hasura migrations",m={unversionedId:"graphql/core/migrations/advanced/resetting-migrations",id:"graphql/core/migrations/advanced/resetting-migrations",title:"Resetting Hasura migrations",description:"Resetting Hasura migrations",source:"@site/docs/graphql/core/migrations/advanced/resetting-migrations.mdx",sourceDirName:"graphql/core/migrations/advanced",slug:"/graphql/core/migrations/advanced/resetting-migrations",permalink:"/graphql-engine/latest/graphql/core/migrations/advanced/resetting-migrations",editUrl:"https://github.com/hasura/graphql-engine/edit/master/docs/docs/graphql/core/migrations/advanced/resetting-migrations.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_label:"Resetting Hasura migrations",sidebar_position:5,description:"Resetting Hasura migrations",keywords:["hasura","docs","migration","reset migrations","clear migrations"]},sidebar:"docsSidebar",previous:{title:"Creating a seed data migration",permalink:"/graphql-engine/latest/graphql/core/migrations/advanced/seed-data-migration"},next:{title:"Reference documentation",permalink:"/graphql-engine/latest/graphql/core/migrations/reference/"}},c={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Step 1: Delete the local migration files",id:"step-1-delete-the-local-migration-files",level:2},{value:"Step 2: Reset the migration history on the server",id:"step-2-reset-the-migration-history-on-the-server",level:2},{value:"Step 3: Pull the schema and metadata from the server",id:"step-3-pull-the-schema-and-metadata-from-the-server",level:2},{value:"Step 4: Verify the status of the migrations",id:"step-4-verify-the-status-of-the-migrations",level:2}],p={toc:u};function d(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"resetting-hasura-migrations"},"Resetting Hasura migrations"),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"This page explains how to reset the state of migrations and create new\nmigrations from the state that is on the server. This can be useful if\nthe current migration state on your local machine is corrupted."),(0,i.kt)("h2",{id:"step-1-delete-the-local-migration-files"},"Step 1: Delete the local migration files"),(0,i.kt)("p",null,"Move all your migrations to a backup folder, in case you may need them\nlater."),(0,i.kt)("p",null,"You can use the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# move the contents of the migrations folder into the migrations_backup folder\n\nmv migrations migrations_backup\n")),(0,i.kt)("h2",{id:"step-2-reset-the-migration-history-on-the-server"},"Step 2: Reset the migration history on the server"),(0,i.kt)("p",null,"To reset the migrations status on the server only, use:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# reset migrations on server only\n\nhasura migrate delete --all --server --database-name <database-name>\n")),(0,i.kt)("p",null,"To reset the migrations status on server and clean up the local project\nmigration files"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# reset migrations on server and on local project, use:\n\nhasura migrate delete --all --database-name <database-name>\n")),(0,i.kt)("h2",{id:"step-3-pull-the-schema-and-metadata-from-the-server"},"Step 3: Pull the schema and metadata from the server"),(0,i.kt)("p",null,"If the migrations were reset, then we will set up fresh migrations by\npulling the schema and metadata from the server using the following\ncommands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'## create migration files - "this will only export public schema from postgres"\n\nhasura migrate create "init" --from-server --database-name <database-name>\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'## note down the version\n## mark the migration as applied on this server\n\nhasura migrate apply --version "<version>" --skip-execution --database-name <database-name>\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"## to also export the Hasura metadata and save it in the ``/metadata`` directory\n\nhasura metadata export\n")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you are using schemas other than ",(0,i.kt)("inlineCode",{parentName:"p"},"public"),", use the\n",(0,i.kt)("inlineCode",{parentName:"p"},"--schema <schema_name>")," flag to indicate each one of them in the create\ncommand. This flag can be used multiple times."))),(0,i.kt)("h2",{id:"step-4-verify-the-status-of-the-migrations"},"Step 4: Verify the status of the migrations"),(0,i.kt)("p",null,"Run the following command to verify the migration status:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"hasura migrate status  --database-name <database-name>\n")),(0,i.kt)("p",null,"You should see the new migrations!"))}d.isMDXComponent=!0}}]);